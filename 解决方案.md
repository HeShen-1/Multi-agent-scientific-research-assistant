# è§£å†³æ–¹æ¡ˆå’Œæ•…éšœæ’æŸ¥æŒ‡å—

æœ¬æ–‡æ¡£æä¾›äº†å¤šæ™ºèƒ½ä½“ç§‘ç ”åŠ©æ‰‹å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€é…ç½®æŒ‡å—å’ŒæŠ€æœ¯ç»†èŠ‚ã€‚

## ğŸš¨ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### 1. `LLM Provider NOT provided` é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
litellm.BadRequestError: LLM Provider NOT provided. 
Pass in the LLM provider you are trying to call. You passed model=deepseek-chat
```

**æ ¹æœ¬åŸå› ï¼š**
CrewAIå†…éƒ¨ä½¿ç”¨LiteLLMæ¥å¤„ç†å„ç§LLMæä¾›å•†ï¼Œä½†LiteLLMæ— æ³•è¯†åˆ«`deepseek-chat`è¿™ä¸ªæ¨¡å‹åç§°ï¼Œä¸çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸ªæä¾›å•†æ¥å¤„ç†è¯·æ±‚ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
ç³»ç»Ÿå·²é€šè¿‡åœ¨æ¨¡å‹åç§°å‰æ·»åŠ `openai/`å‰ç¼€ (`openai/deepseek-chat`) æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä»¥å‘ŠçŸ¥LiteLLMè¿™æ˜¯ä¸€ä¸ªä¸OpenAIå…¼å®¹çš„APIã€‚æ­¤ä¿®å¤å·²å†…ç½®äºä»£ç ä¸­ï¼Œæ‚¨æ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

**è¯¦ç»†ä¿®å¤é€»è¾‘ (`agents/research_agents.py`)ï¼š**
```python
llm = ChatOpenAI(
    model="openai/deepseek-chat",  # å…³é”®ä¿®å¤ç‚¹
    openai_api_key=config['api_key'],
    openai_api_base=config['base_url'] + '/v1',
    # ... å…¶ä»–å‚æ•°
)
```
æ‚¨å¯ä»¥åœ¨`.env`æ–‡ä»¶ä¸­ç»§ç»­ä½¿ç”¨`deepseek-chat`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†å‰ç¼€ã€‚

### 2. Cloudflareé˜²æŠ¤æ‹¦æˆª

**é”™è¯¯ä¿¡æ¯ï¼š**
```
<!DOCTYPE html><html lang="en-US"><head><title>Just a moment...</title>
```

**åŸå› ï¼š** DeepSeek APIå¯èƒ½è¢«Cloudflareé˜²æŠ¤ç³»ç»Ÿæ‹¦æˆªã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1.  **æ›´æ¢ç½‘ç»œç¯å¢ƒ**ï¼šå°è¯•ä½¿ç”¨ä¸åŒçš„ç½‘ç»œè¿æ¥ï¼ˆå¦‚æ‰‹æœºçƒ­ç‚¹ï¼‰ã€‚
2.  **ä½¿ç”¨ä»£ç†**ï¼šé…ç½®HTTPä»£ç†ç»•è¿‡é˜²æŠ¤ã€‚
3.  **ç­‰å¾…é‡è¯•**ï¼šç³»ç»Ÿå†…ç½®äº†é‡è¯•æœºåˆ¶ï¼Œé€šå¸¸å‡ åˆ†é’Ÿåå¯æ¢å¤ã€‚
4.  **è”ç³»DeepSeekæ”¯æŒ**ï¼šå¦‚é—®é¢˜æŒç»­ï¼Œè¯·è”ç³»å®˜æ–¹æŠ€æœ¯æ”¯æŒã€‚

### 3. Connection Error é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š** `Connection error`

**åŸå› ï¼š** ç½‘ç»œè¿æ¥é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
1.  æ£€æŸ¥æ‚¨çš„æœ¬åœ°ç½‘ç»œè¿æ¥ã€‚
2.  ç¡®è®¤DeepSeek APIæœåŠ¡çŠ¶æ€ã€‚
3.  å°è¯•æ›´æ¢DNSæœåŠ¡å™¨ï¼ˆå¦‚`8.8.8.8`æˆ–`1.1.1.1`ï¼‰ã€‚
4.  æ£€æŸ¥é˜²ç«å¢™æˆ–å®‰å…¨è½¯ä»¶è®¾ç½®æ˜¯å¦é˜»æ­¢äº†ç¨‹åºè®¿é—®ç½‘ç»œã€‚

### 4. API Key ç›¸å…³é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š** `Invalid API key`

**è§£å†³æ–¹æ¡ˆï¼š**
1.  ç¡®è®¤`.env`æ–‡ä»¶ä¸­çš„`OPENAI_API_KEY`æ ¼å¼æ­£ç¡®ï¼ˆä»¥`sk-`å¼€å¤´ï¼‰ã€‚
2.  æ£€æŸ¥APIå¯†é’¥æ˜¯å¦è¢«ç¦ç”¨æˆ–è¿‡æœŸã€‚
3.  ç™»å½•DeepSeekå¹³å°ï¼Œç¡®è®¤è´¦æˆ·ä½™é¢å……è¶³ã€‚
4.  å°è¯•é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„APIå¯†é’¥ã€‚

### 5. æ¨¡æ¿å˜é‡ç¼ºå¤±é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Missing required template variable 'Template variable 'validation_feedback' not found in inputs dictionary' in description
```

**æ ¹æœ¬åŸå› ï¼š**
åœ¨ä»»åŠ¡æè¿°æ¨¡æ¿ä¸­å¼•ç”¨äº† `{validation_feedback}` å˜é‡ï¼Œä½†åœ¨æŸäº›è°ƒç”¨åœºæ™¯ä¸‹æ²¡æœ‰æä¾›è¿™ä¸ªå˜é‡å€¼ï¼Œå¯¼è‡´æ¨¡æ¿æ¸²æŸ“å¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
ç³»ç»Ÿå·²ä¿®å¤æ­¤é—®é¢˜ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³ï¼š
1. åˆ›å»ºäº†ä¿®å¤ç‰ˆæœ¬çš„ä»»åŠ¡å‡½æ•° `create_integrated_analysis_task_fixed`
2. ä½¿ç”¨åŠ¨æ€å­—ç¬¦ä¸²æ„å»ºè€Œä¸æ˜¯æ¨¡æ¿æ’å€¼æ¥å¤„ç†å¯é€‰å‚æ•°
3. åœ¨è°ƒç”¨æ—¶æ ¹æ®æ˜¯å¦æœ‰éªŒè¯åé¦ˆæ¥å†³å®šæ˜¯å¦æ·»åŠ ç›¸å…³å†…å®¹

**æŠ€æœ¯ç»†èŠ‚ï¼š**
- ä¿®å¤æ–‡ä»¶ï¼š`tasks/research_tasks_fixed.py`
- ä¸»è¦ä¿®æ”¹ï¼šä½¿ç”¨ Python å­—ç¬¦ä¸²æ‹¼æ¥ä»£æ›¿æ¨¡æ¿å˜é‡å¼•ç”¨
- å‘åå…¼å®¹ï¼šä¿æŒåŸæœ‰APIæ¥å£ä¸å˜

## ğŸ”§ é…ç½®ä¸å®‰è£…

### ç¼ºå°‘.envæ–‡ä»¶

**ç°è±¡ï¼š** ç¨‹åºå¯åŠ¨æ—¶æç¤ºæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨é…ç½®åŠ©æ‰‹ï¼ˆå¦‚æœé¡¹ç›®æä¾›ï¼‰
# python setup_config.py

# æ–¹æ³•2ï¼šæ‰‹åŠ¨åˆ›å»º
cp env_example.txt .env
# ç„¶åç”¨æ‚¨çš„ç¼–è¾‘å™¨æ‰“å¼€.envæ–‡ä»¶ï¼Œè®¾ç½®æ‚¨çš„APIå¯†é’¥
```

### APIè¿é€šæ€§æµ‹è¯•å¤±è´¥

å¦‚æœæ€€ç–‘æ˜¯APIè¿æ¥é—®é¢˜ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹è„šæœ¬è¿›è¡Œæµ‹è¯•ï¼š
```bash
# è¿è¡Œè¿é€šæ€§æµ‹è¯•
python -c "
from utils.network_utils import check_api_connectivity
import os
from dotenv import load_dotenv
load_dotenv()
api_base = os.getenv('OPENAI_API_BASE', 'https://api.deepseek.com/v1')
api_key = os.getenv('OPENAI_API_KEY')
print('è¿é€šæ€§æµ‹è¯•ç»“æœ:', check_api_connectivity(api_base, api_key))
"
```

## ğŸŒ ç½‘ç»œé—®é¢˜

### é¢‘ç¹è¶…æ—¶

**è§£å†³æ–¹æ¡ˆï¼š**
1.  åœ¨ä»£ç ä¸­é€‚å½“å¢åŠ è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚
2.  ä½¿ç”¨æ›´ç¨³å®šçš„ç½‘ç»œè¿æ¥ã€‚
3.  ä¸ºæ‚¨çš„ç³»ç»Ÿæˆ–ç»ˆç«¯é…ç½®HTTPä»£ç†ã€‚

### é€Ÿç‡é™åˆ¶

**é”™è¯¯ä¿¡æ¯ï¼š** `Rate limit exceeded`

**è§£å†³æ–¹æ¡ˆï¼š**
1.  ç³»ç»Ÿå·²å†…ç½®åŸºäº`tenacity`çš„æ™ºèƒ½é‡è¯•å’Œé€Ÿç‡é™åˆ¶å™¨ï¼Œä¼šè‡ªåŠ¨å¤„ç†ã€‚
2.  å¦‚æœé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œå¯ä»¥å°è¯•é™ä½å¹¶å‘è¯·æ±‚æ•°ã€‚
3.  å¦‚æœæ‚¨çš„ç”¨é‡å¾ˆå¤§ï¼Œè¯·è€ƒè™‘å‡çº§æ‚¨çš„APIå¥—é¤ä»¥è·å¾—æ›´é«˜çš„è¯·æ±‚é™é¢ã€‚

## ğŸ”„ OpenAI SDKè¿ç§»ä¸æ··åˆæ¶æ„

ä¸ºäº†æå‡æ€§èƒ½å’Œå…¼å®¹æ€§ï¼Œé¡¹ç›®é‡‡ç”¨äº†ç›´æ¥`openai` SDKè°ƒç”¨å’Œ`langchain_openai`ï¼ˆç”¨äºCrewAIï¼‰çš„æ··åˆæ¶æ„ã€‚

### æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            åº”ç”¨æ¶æ„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CrewAIæ™ºèƒ½ä½“ (Agents)                  â”‚
â”‚  â””â”€â”€ ä½¿ç”¨ langchain_openai.ChatOpenAI     â”‚
â”‚                                         â”‚
â”‚  ç›´æ¥APIè°ƒç”¨ (e.g., Tests, Utils)       â”‚
â”‚  â””â”€â”€ ä½¿ç”¨ openai.OpenAI å®¢æˆ·ç«¯            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä¼˜åŠ¿
1.  **æ€§èƒ½ä¼˜åŒ–**: ç›´æ¥APIè°ƒç”¨å‡å°‘äº†`langchain`çš„ä¸­é—´å±‚å¼€é”€ã€‚
2.  **åŠŸèƒ½å®Œæ•´**: å¯ä»¥ç›´æ¥ä½¿ç”¨OpenAI SDKçš„æ‰€æœ‰æœ€æ–°åŠŸèƒ½ã€‚
3.  **å‘åå…¼å®¹**: CrewAIæ™ºèƒ½ä½“æ— éœ€ä¿®æ”¹å³å¯å·¥ä½œã€‚
4.  **é…ç½®ç»Ÿä¸€**: å•ä¸€çš„`.env`é…ç½®æºç®¡ç†æ‰€æœ‰APIè¿æ¥ã€‚

### ä½¿ç”¨ç¤ºä¾‹

**ç›´æ¥ä½¿ç”¨OpenAI SDK**
```python
from agents.research_agents import create_openai_client, get_model_config

# åˆ›å»ºå®¢æˆ·ç«¯
client = create_openai_client()
config = get_model_config()

# å‘é€è¯·æ±‚
response = client.chat.completions.create(
    model=config['model'],
    messages=[
        {"role": "system", "content": "You are a helpful assistant"},
        {"role": "user", "content": "Hello"},
    ],
    stream=False
)

print(response.choices[0].message.content)
```

**CrewAIæ™ºèƒ½ä½“ï¼ˆè‡ªåŠ¨å¤„ç†å…¼å®¹æ€§ï¼‰**
```python
from agents.research_agents import create_research_manager

# åˆ›å»ºæ™ºèƒ½ä½“ï¼ˆå†…éƒ¨è‡ªåŠ¨ä½¿ç”¨å…¼å®¹çš„LLMï¼‰
agent = create_research_manager()
```

## ğŸ“‹ è¯Šæ–­æ­¥éª¤

### 1. åŸºç¡€æ£€æŸ¥
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la .env

# éªŒè¯é…ç½®å†…å®¹ï¼ˆå¦‚æœé¡¹ç›®æä¾›ï¼‰
# python setup_config.py
```

### 2. ç½‘ç»œæµ‹è¯•
```bash
# æµ‹è¯•åŸŸåè§£æå’Œç½‘ç»œå»¶è¿Ÿ
ping api.deepseek.com

# ä½¿ç”¨curlæµ‹è¯•APIç«¯ç‚¹ï¼ˆè¯·æ›¿æ¢YOUR_API_KEYï¼‰
curl -H "Authorization: Bearer YOUR_API_KEY" https://api.deepseek.com/v1/models
```

### 3. ä¾èµ–æ£€æŸ¥
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version

# æ£€æŸ¥å…³é”®ä¾èµ–åŒ…ç‰ˆæœ¬
pip list | grep -E "(crewai|langchain|openai|litellm)"

# å¦‚æœæ€€ç–‘ä¾èµ–æœ‰é—®é¢˜ï¼Œå¼ºåˆ¶é‡æ–°å®‰è£…
pip install -r requirements.txt --upgrade --force-reinstall
```

## ğŸ†˜ è·å–å¸®åŠ©

### æ—¥å¿—åˆ†æ
`research_assistant.log`æ–‡ä»¶åŒ…å«äº†è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œæ˜¯æ’æŸ¥é—®é¢˜çš„é¦–é€‰ã€‚
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—è¾“å‡º
tail -f research_assistant.log
```

### è”ç³»æ”¯æŒ
å¦‚æœé—®é¢˜ä»ç„¶æ— æ³•è§£å†³ï¼š
1.  æ”¶é›†`research_assistant.log`ä¸­çš„ç›¸å…³é”™è¯¯æ—¥å¿—ã€‚
2.  è®°å½•æ‚¨è¾“å…¥çš„ä¸»é¢˜å’Œå¤ç°é—®é¢˜çš„æ­¥éª¤ã€‚
3.  é™„ä¸Šæ‚¨çš„æ“ä½œç³»ç»Ÿã€Pythonç‰ˆæœ¬ç­‰ç¯å¢ƒä¿¡æ¯ã€‚
4.  åœ¨é¡¹ç›®çš„GitHubé¡µé¢æäº¤Issueæˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
